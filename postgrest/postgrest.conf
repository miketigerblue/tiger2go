# /etc/postgrest.conf

# --- Database connection ---
# Use env var so you don't bake secrets into the image.
# Set PGRST_DB_URI as a Fly secret or runtime env var.
db-uri = "$(PGRST_DB_URI)"

# Expose only the API schema (prevents accidental exposure of public tables/views).
db-schemas = "api"

# Role used for requests without a JWT
db-anon-role = "postgrest-anon"

# --- Server ---
server-host = "!4"
server-port = 3000

# --- OpenAPI / docs ---
# Keeps docs available (handy). Set to false if you want to hide them.
openapi-mode = "follow-privileges"

# If you're behind a reverse proxy / Fly's edge, this keeps the OpenAPI base correct.
openapi-server-proxy-uri = "$(PGRST_OPENAPI_SERVER_PROXY_URI)"

# --- Performance / behaviour ---
# Number of DB connections PostgREST will keep in its pool.
db-pool = 10

# Seconds to keep an idle DB connection alive in the pool.
db-pool-timeout = 10

# Max rows returned if client doesn't specify limit (prevents accidental huge responses)
db-max-rows = 1000

# Require clients to use explicit limits via Range headers? (leave off unless you want strictness)
# db-max-rows = 100

# --- Logging ---
# "info" is a good default; switch to "warn" once stable.
log-level = "info"
log-query = false
